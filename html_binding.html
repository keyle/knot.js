<!DOCTYPE html>
<html>
<head>
	<title>test</title>
	<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.1.min.js"></script>
	<script type="text/javascript" src="knot.js"></script>
</head>
<body>

<!--<table data-collection='posts' border='1'>
	<tr>
		<th>title</th>
		<th>date</th>
		<th>link</th>
	</tr>
	<tr data-collection-item>
		<td data-bind='title'>title default</td>
		<td data-bind='date'>date default</td>
		<td data-bind='link'>link default</td>
	</tr>
</table>-->

<ul data-bind='posts'>
	<li data-repeater>{title}, {date}, {link}</li>
</ul>
blaaaahr
<ul data-bind='posts'>
	<li data-repeater>{title}, {date}, {link}</li>
</ul>

<table border=1 data-bind='posts'>
		<tr> <th>tit</th><th>link</th><th>link</th>  </tr>
		<tr data-repeater=''> <td>{title}</td><td>{link}</td><td>{date}</td> </tr>
</table>

<script type="text/javascript">

	var model =
	{
		posts :
		[
			{ title: 'title 1', date: '22/11/1980', link: 'http://noben.org/' },
			{ title: 'title 2', date: '12/12/1995', link: 'http://idle.org/' },
			{ title: 'title 3', date: '25/03/1999', link: 'http://news.org/' },
			{ title: 'title 4', date: '05/05/2011', link: 'http://pebbles.org/' },
		]
	}

	$(document).ready(function() {

		bindAllCollections();

		$('#refresh').click(changeData);
	});

	function changeData()
	{
		model.posts[0].title = (Math.random()*128).toString();
		bindAllCollections();
	}

	function bindAllCollections()
	{
		$(document).find('*[data-bind]').each(bindCollection);
	}

	function bindCollection()
	{
		var collection = model[this.dataset.bind];

		if(!collection) return; // no model object found


		// hide the template - we will need it again on refresh.
		$($(this).find('*[data-repeater]')[0]).css('display', 'inherit');
		var repeatHTML = $(this).find('*[data-repeater]')[0].outerHTML;
		$($(this).find('*[data-repeater]')[0]).css('display', 'none');

		var papa = $(this).find('*[data-repeater]').parent();

		// remove all except the first, it's our template
		$(this).find('*[data-repeater]').nextAll().remove();

		for (var i = 0; i < collection.length; i++)
		{
			// make a copy
			var newhtml = repeatHTML;

			for(var key in collection[i])
			{
				// using split join as a replace All
				newhtml = newhtml.split('{'+key+'}').join(collection[i][key]);
			}
			//$(newhtml).removeAttr('data-repeater');
			console.log(papa);
			$(papa).append(newhtml);
		}

	}

// format string

String.prototype.format = function() {
    var s = this,
        i = arguments.length;

    while (i--) {
        s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
    }
    return s;
};

String.prototype.f = String.prototype.format;

</script>



* find all tag by attribute data-collection
* for each tag
* find the data-collection object corresponding
* find collection-item object
* template it and remove it
* for each collection item in the model
* add the template with replace {var name}

- alternate rows?
- how to show multiple data fields in the one html field? (converter?)
<br />
<br />
<br />
<button id='refresh'>refresh</button>

</body>
</html>
